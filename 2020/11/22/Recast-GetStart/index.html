<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swordhell.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":{"gitalk":{"order":-2}},"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Recast-入门Recast-Navigation 在做3d游戏的时候，用于做导航的在Unity3D、Unreal Engine都可以使用。当前使用 unreal 4.25">
<meta property="og:type" content="article">
<meta property="og:title" content="Recast-GetStart">
<meta property="og:url" content="https://swordhell.github.io/2020/11/22/Recast-GetStart/index.html">
<meta property="og:site_name" content="Abel&#39;Blog">
<meta property="og:description" content="Recast-入门Recast-Navigation 在做3d游戏的时候，用于做导航的在Unity3D、Unreal Engine都可以使用。当前使用 unreal 4.25">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/22/rr16JS.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/22/rrHrJs.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/22/rrHsWn.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/12/22/rrHcQ0.png">
<meta property="og:image" content="https://s3.ax1x.com/2021/02/02/ymUU0I.gif">
<meta property="og:image" content="https://s3.ax1x.com/2021/02/02/ymUNnA.gif">
<meta property="og:image" content="https://s3.ax1x.com/2021/02/02/ymUz9O.gif">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/02/fShu5j.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/02/fShnaQ.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/02/f9YKIg.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/03/fPYIyR.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/03/fPYoO1.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/04/fAfk8S.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/04/fAfFC8.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/04/fAhFd1.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/08/04/fAhiZR.png">
<meta property="article:published_time" content="2020-11-21T16:00:00.000Z">
<meta property="article:modified_time" content="2023-06-07T01:46:42.064Z">
<meta property="article:author" content="Abel Sean">
<meta property="article:tag" content="Game">
<meta property="article:tag" content="recast">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.ax1x.com/2020/12/22/rr16JS.png">

<link rel="canonical" href="https://swordhell.github.io/2020/11/22/Recast-GetStart/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Recast-GetStart | Abel'Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Abel'Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">我干了什么?究竟拿了时间换了什么?</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swordhell.github.io/2020/11/22/Recast-GetStart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Abel Sean">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Abel'Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Recast-GetStart
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-22 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-22T00:00:00+08:00">2020-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-07 09:46:42" itemprop="dateModified" datetime="2023-06-07T09:46:42+08:00">2023-06-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/2-%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">2-应用</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/2-%E5%BA%94%E7%94%A8/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">游戏开发</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Recast-入门"><a href="#Recast-入门" class="headerlink" title="Recast-入门"></a>Recast-入门</h2><p>Recast-Navigation 在做3d游戏的时候，用于做导航的在Unity3D、Unreal Engine都可以使用。当前使用 unreal 4.25</p>
<span id="more"></span>
<h3 id="1-Recast工程介绍"><a href="#1-Recast工程介绍" class="headerlink" title="1. Recast工程介绍"></a>1. Recast工程介绍</h3><p>RecastNavigation 是一个的导航寻路工具集，它包括了几个子集：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Recast：负责根据提供的模型生成导航网格。</span><br><span class="line">Detour：利用导航网格做寻路操作。这里的导航网格可以是 Recast 生成的，也可以是其他工具生成的。</span><br><span class="line">DetourCrowd：提供了群体寻路行为的功能。</span><br><span class="line">Recast Demo：一个很完善的 Demo，基本上将 Recast 、 Detour 提供的功能都很好地展现了出来。弄懂了这个 Demo 的功能，基本也就了解了 RecastNavigation 究竟可以干什么事。</span><br></pre></td></tr></table></figure>
<!-- more -->
<p>Recast先从几何体构造素模，然后在其上投射导航网格。此过程包括三个步骤：</p>
<ol>
<li>创建素模(voxel mold)；</li>
</ol>
<p>通过将三角形栅格化为多层高度场，从输入三角形网格构建体素模具。然后将一些简单的滤镜应用到模具上，以修剪角色无法移动的位置。</p>
<ol>
<li>将素模划分成简单区域(region)；</li>
</ol>
<p>模具描述的可行走区域分为简单的2D覆盖区域。 生成的区域仅具有不重叠的轮廓，这大大简化了过程的最后一步。</p>
<ol>
<li>将区域转换成多边形(polygons)；</li>
</ol>
<p>通过首先跟踪边界，然后对其进行简化，可以将导航多边形从区域中剥离。 最终将生成的多边形转换为凸多边形，这使它们非常适合该级的寻路和空间推理。</p>
<blockquote>
<p>注：凸多边形的内角均小于或等于180°，边数为n（n属于Z且n大于2）的凸多边形内角和为（n－2）×180°，但任意凸多边形外角和均为360°，并可通过反证法证明凸多边形内角中锐角的个数不能多于3个。</p>
</blockquote>
<p>尝试将unreal engine 里面的地图导出成detour能使用的导航网格：</p>
<p>再 UNREAL ENGINE 里面地图是<em>.umap文件。我们用UE打开之后，在菜单栏里面操作： Windows-&gt;导出NavMesh。这个步骤将会生成一个</em>.obj文件。这种文件其实是一种文本文件，描述了3D对象模型信息。Unity3D也一样能导出这样的文件。此过程将会生成某个尺寸的模型文件。</p>
<p>我们移植了一些Detour的代码，编写了一个程序 RecastCreator。这个程序能将*.obj文件导出成为一个binary文件。后续就直接使用binary文件来做导航操作。</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">PS D:\work\trunk\refer\recastnavigation\RecastDemo\Bin\Meshes&gt; .\RecastCreator.exe -cfg -out t3.obj t3.region</span><br><span class="line">----- Create Cfg -----</span><br><span class="line">cellsize = <span class="number">0</span>.<span class="number">30</span></span><br><span class="line">cellheight = <span class="number">0</span>.<span class="number">20</span></span><br><span class="line">agentheight = <span class="number">2</span></span><br><span class="line">agentradius = <span class="number">0</span>.<span class="number">6</span></span><br><span class="line">agentmaxclimb = <span class="number">0</span>.<span class="number">9</span></span><br><span class="line">agentmaxslope = <span class="number">45</span></span><br><span class="line">regionminsize = <span class="number">8</span></span><br><span class="line">regionmergesize = <span class="number">20</span></span><br><span class="line">edgemaxlen = <span class="number">12</span></span><br><span class="line">edgemaxerror = <span class="number">1</span>.<span class="number">3</span></span><br><span class="line">vertsperpoly = <span class="number">6</span></span><br><span class="line">detailsampledist = <span class="number">6</span></span><br><span class="line">detailsamplemaxerror = <span class="number">1</span></span><br><span class="line">partitiontype = <span class="number">1</span></span><br><span class="line">tilesize = <span class="number">0</span></span><br><span class="line">----- End -----</span><br><span class="line">PS D:\work\trunk\refer\recastnavigation\RecastDemo\Bin\Meshes&gt; .\RecastCreator.exe -out t3.obj t3.region</span><br><span class="line">----- Create Bin -----</span><br><span class="line">Building navigation:</span><br><span class="line"> - <span class="number">1028</span> x <span class="number">1135</span> cells</span><br><span class="line"> - <span class="number">525</span>.<span class="number">2</span>K verts, <span class="number">306</span>.<span class="number">2</span>K tris</span><br><span class="line">Build Times</span><br><span class="line">- Rasterize:    <span class="number">176</span>.<span class="number">99</span>ms        (<span class="number">24</span>.<span class="number">5</span>%)</span><br><span class="line">- Build <span class="built_in">Compact</span>:        <span class="number">39</span>.<span class="number">54</span>ms (<span class="number">5</span>.<span class="number">5</span>%)</span><br><span class="line">- Filter Border:        <span class="number">29</span>.<span class="number">55</span>ms (<span class="number">4</span>.<span class="number">1</span>%)</span><br><span class="line">- Filter Walkable:      <span class="number">5</span>.<span class="number">15</span>ms  (<span class="number">0</span>.<span class="number">7</span>%)</span><br><span class="line">- Erode Area:   <span class="number">19</span>.<span class="number">18</span>ms (<span class="number">2</span>.<span class="number">7</span>%)</span><br><span class="line">- Median Area:  <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">- Mark Box Area:        <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">- Mark Convex Area:     <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">- Mark Cylinder Area:   <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">- Build Distance Field: <span class="number">29</span>.<span class="number">01</span>ms (<span class="number">4</span>.<span class="number">0</span>%)</span><br><span class="line">    - Distance: <span class="number">19</span>.<span class="number">88</span>ms (<span class="number">2</span>.<span class="number">7</span>%)</span><br><span class="line">    - Blur:     <span class="number">8</span>.<span class="number">95</span>ms  (<span class="number">1</span>.<span class="number">2</span>%)</span><br><span class="line">- Build Regions:        <span class="number">105</span>.<span class="number">62</span>ms        (<span class="number">14</span>.<span class="number">6</span>%)</span><br><span class="line">    - Watershed:        <span class="number">97</span>.<span class="number">48</span>ms (<span class="number">13</span>.<span class="number">5</span>%)</span><br><span class="line">      - Expand: <span class="number">35</span>.<span class="number">47</span>ms (<span class="number">4</span>.<span class="number">9</span>%)</span><br><span class="line">      - <span class="built_in">Find</span> Basins:    <span class="number">2</span>.<span class="number">93</span>ms  (<span class="number">0</span>.<span class="number">4</span>%)</span><br><span class="line">    - Filter:   <span class="number">6</span>.<span class="number">76</span>ms  (<span class="number">0</span>.<span class="number">9</span>%)</span><br><span class="line">- Build Layers: <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">- Build Contours:       <span class="number">13</span>.<span class="number">14</span>ms (<span class="number">1</span>.<span class="number">8</span>%)</span><br><span class="line">    - Trace:    <span class="number">8</span>.<span class="number">87</span>ms  (<span class="number">1</span>.<span class="number">2</span>%)</span><br><span class="line">    - Simplify: <span class="number">2</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">3</span>%)</span><br><span class="line">- Build Polymesh:       <span class="number">6</span>.<span class="number">09</span>ms  (<span class="number">0</span>.<span class="number">8</span>%)</span><br><span class="line">- Build Polymesh Detail:        <span class="number">286</span>.<span class="number">67</span>ms        (<span class="number">39</span>.<span class="number">6</span>%)</span><br><span class="line">- Merge Polymeshes:     <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">- Merge Polymesh Details:       <span class="number">0</span>.<span class="number">00</span>ms  (<span class="number">0</span>.<span class="number">0</span>%)</span><br><span class="line">=== TOTAL:      <span class="number">723</span>.<span class="number">73</span>ms</span><br><span class="line">&gt;&gt; Polymesh: <span class="number">2552</span> vertices  <span class="number">1153</span> polygons</span><br><span class="line"></span><br><span class="line">----- End -----</span><br></pre></td></tr></table></figure>
<h3 id="2-环境搭建"><a href="#2-环境搭建" class="headerlink" title="2.环境搭建"></a>2.环境搭建</h3><h4 id="2-1-编译recastnavigation"><a href="#2-1-编译recastnavigation" class="headerlink" title="2.1.编译recastnavigation"></a>2.1.编译recastnavigation</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">工具名称</th>
<th style="text-align:left">版本信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">visualstudio2019</td>
<td style="text-align:left">16.8.3</td>
</tr>
<tr>
<td style="text-align:left">CMake</td>
<td style="text-align:left">3.19.0-rc1</td>
</tr>
<tr>
<td style="text-align:left">premake</td>
<td style="text-align:left">5.0</td>
</tr>
</tbody>
</table>
</div>
<h5 id="2-1-1-下载地址"><a href="#2-1-1-下载地址" class="headerlink" title="2.1.1.下载地址"></a>2.1.1.下载地址</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">下载地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SDL</td>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://www.libsdl.org/release/SDL2-devel-2.0.14-VC.zip">SDL2-devel-2.0.14-VC.zip</a></td>
</tr>
<tr>
<td style="text-align:left">premake</td>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://premake.github.io/">premake.github</a></td>
</tr>
</tbody>
</table>
</div>
<h5 id="2-1-2-准备好SDL2的dll"><a href="#2-1-2-准备好SDL2的dll" class="headerlink" title="2.1.2.准备好SDL2的dll"></a>2.1.2.准备好SDL2的dll</h5><p>将上述的<code>SDL2-devel-2.0.14--VC.zip</code>文件解压缩，放入到<code>$&#123;RecastDemo&#125;\Contrib\SDL</code>目录中。因为在</p>
<h5 id="2-1-3-使用premake5生成工程文件"><a href="#2-1-3-使用premake5生成工程文件" class="headerlink" title="2.1.3.使用premake5生成工程文件"></a>2.1.3.使用premake5生成工程文件</h5><p>这个默认生成的是win32位的</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\<span class="title">work</span>\<span class="title">trunk</span>\<span class="title">refer</span>\<span class="title">recastnavigation</span>\<span class="title">RecastDemo</span>&gt;&quot;<span class="title">premake5</span>&quot; <span class="title">vs2019</span></span></span><br><span class="line"><span class="function"><span class="title">Building</span> <span class="title">configurations</span>...</span></span><br><span class="line"><span class="function"><span class="title">Running</span> <span class="title">action</span> &#x27;<span class="title">vs2019</span>&#x27;...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">recastnavigation.sln</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">DebugUtils.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">DebugUtils.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Detour.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Detour.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">DetourCrowd.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">DetourCrowd.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">DetourTileCache.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">DetourTileCache.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Recast.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Recast.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">RecastDemo.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">RecastDemo.vcxproj.user</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">RecastDemo.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Tests.vcxproj</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Tests.vcxproj.user</span>...</span></span><br><span class="line"><span class="function"><span class="title">Generated</span> <span class="title">Build</span>/<span class="title">vs2019</span>/<span class="title">Tests.vcxproj.filters</span>...</span></span><br><span class="line"><span class="function"><span class="title">Done</span> (225<span class="title">ms</span>).</span></span><br></pre></td></tr></table></figure>
<p>RecastDemo的效果图：</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/rr16JS"><img src="https://s3.ax1x.com/2020/12/22/rr16JS.png" alt="rr16JS.png"></a></p>
<p>加载一个obj文件：</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/rrHrJs"><img src="https://s3.ax1x.com/2020/12/22/rrHrJs.png" alt="rrHrJs.png"></a></p>
<p>将obj文件的导航网格生成出来：</p>
<p>生成了之后，地图的颜色将会变化，只需要点击”Build”。有导航网格，才能去测试导航功能。</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/rrHsWn"><img src="https://s3.ax1x.com/2020/12/22/rrHsWn.png" alt="rrHsWn.png"></a></p>
<p>测试导航功能：</p>
<p>在地图上选择开始结束点；”shift+鼠标左键”</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/rrHcQ0"><img src="https://s3.ax1x.com/2020/12/22/rrHcQ0.png" alt="rrHcQ0.png"></a></p>
<h3 id="3-Recast-导航网格类型"><a href="#3-Recast-导航网格类型" class="headerlink" title="3.Recast 导航网格类型"></a>3.Recast 导航网格类型</h3><p>recastnavigation中提供了3种模式的导航网格：</p>
<h4 id="3-1-SoloMesh"><a href="#3-1-SoloMesh" class="headerlink" title="3.1.SoloMesh"></a>3.1.SoloMesh</h4><p>其中SoloMesh模式是静态的导航网格，即对场景build一次之后，将导航网格缓存起来供寻路使用，后续不再允许场景的导航信息发生变化。</p>
<p>文件头：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> NAVMESHSET_MAGIC = <span class="string">&#x27;M&#x27;</span>&lt;&lt;<span class="number">24</span> | <span class="string">&#x27;S&#x27;</span>&lt;&lt;<span class="number">16</span> | <span class="string">&#x27;E&#x27;</span>&lt;&lt;<span class="number">8</span> | <span class="string">&#x27;T&#x27;</span>; <span class="comment">//&#x27;MSET&#x27;;</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NavMeshSetHeader</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> magic;</span><br><span class="line">    <span class="type">uint32_t</span> version;</span><br><span class="line">    <span class="type">uint32_t</span> numTiles;</span><br><span class="line">    dtNavMeshParams params;</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="comment">// Store header.</span></span><br><span class="line">    NavMeshSetHeader header;</span><br><span class="line">    header.magic = NAVMESHSET_MAGIC;</span><br><span class="line">    header.version = NAVMESHSET_VERSION;</span><br><span class="line">    header.numTiles = <span class="number">0</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-2-TileMesh"><a href="#3-2-TileMesh" class="headerlink" title="3.2.TileMesh"></a>3.2.TileMesh</h4><p>TileMesh也是静态的导航网格，只是与SoloMesh相比它按tile来处理地图，算是介于SoloMesh和TempObstacles之间的一种模式</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名：all_tiles_navmesh.bin</span></span><br><span class="line"><span class="comment">// 文件头： TESM</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> NAVMESHSET_MAGIC = <span class="string">&#x27;M&#x27;</span>&lt;&lt;<span class="number">24</span> | <span class="string">&#x27;S&#x27;</span>&lt;&lt;<span class="number">16</span> | <span class="string">&#x27;E&#x27;</span>&lt;&lt;<span class="number">8</span> | <span class="string">&#x27;T&#x27;</span>; <span class="comment">//&#x27;MSET&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载文件失败：</span></span><br><span class="line">dtStatus addTileStatus = m_tileCache-&gt;<span class="built_in">addTile</span>(data, tileHeader.dataSize, DT_COMPRESSEDTILE_FREE_DATA, &amp;tile);</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">dtStatusFailed</span><span class="params">(dtStatus status)</span></span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> DT_FAILURE </span>= <span class="number">1u</span> &lt;&lt; <span class="number">31</span>;            <span class="comment">// Operation failed.</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> DT_WRONG_MAGIC = <span class="number">1</span> &lt;&lt; <span class="number">0</span>;        <span class="comment">// Input data is not recognized.</span></span><br><span class="line">    <span class="keyword">if</span> (header-&gt;magic != DT_TILECACHE_MAGIC)</span><br><span class="line">        <span class="keyword">return</span> DT_FAILURE | DT_WRONG_MAGIC;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> DT_TILECACHE_MAGIC = <span class="string">&#x27;D&#x27;</span>&lt;&lt;<span class="number">24</span> | <span class="string">&#x27;T&#x27;</span>&lt;&lt;<span class="number">16</span> | <span class="string">&#x27;L&#x27;</span>&lt;&lt;<span class="number">8</span> | <span class="string">&#x27;R&#x27;</span>; <span class="comment">///&lt; &#x27;DTLR&#x27;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sample::<span class="built_in">saveAll</span>(<span class="string">&quot;all_tiles_navmesh.bin&quot;</span>, m_navMesh);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-3-TempObstacles"><a href="#3-3-TempObstacles" class="headerlink" title="3.3.TempObstacles"></a>3.3.TempObstacles</h4><p>TempObstacles模式可以支持向场景中动态添加或移除预设形状的阻挡物，导航网格也会随之更新（不过只支持添加阻挡物，而不支持添加新的可行走区域）在处理动态阻挡时，由于单个阻挡对地图的影响区域是有限的，所以会采用将地图切割成多个固定大小的tile，以tile为单位进行网格的生成。这样在添加或移除阻挡时，只需要处理与阻挡相交的tile，而不需要处理整个地图。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> TILECACHESET_MAGIC = <span class="string">&#x27;T&#x27;</span> &lt;&lt; <span class="number">24</span> | <span class="string">&#x27;S&#x27;</span> &lt;&lt; <span class="number">16</span> | <span class="string">&#x27;E&#x27;</span> &lt;&lt; <span class="number">8</span> | <span class="string">&#x27;T&#x27;</span>; <span class="comment">//&#x27;TSET&#x27;;</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/ZLSYMDJ/NavMeshDemo">参考NavMeshDemo源码</a></p>
<h4 id="3-4-导出Mesh的源码分析"><a href="#3-4-导出Mesh的源码分析" class="headerlink" title="3.4.导出Mesh的源码分析"></a>3.4.导出Mesh的源码分析</h4><p>参考官方的代码-RecastDemo部分，在右边的上部，”Sample”中下拉菜单中选择的三类(Solo Mesh、Tile Mesh、Temp Obstacles)导出方式都看明白。</p>
<p>3种导出方式：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Sample* <span class="title">createSolo</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Sample_SoloMesh</span>(); &#125;</span><br><span class="line"><span class="function">Sample* <span class="title">createTile</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Sample_TileMesh</span>(); &#125;</span><br><span class="line"><span class="function">Sample* <span class="title">createTempObstacle</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Sample_TempObstacles</span>(); &#125;</span><br></pre></td></tr></table></figure>
<p>“Build”按钮将会调用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">imguiButton</span>(<span class="string">&quot;Build&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    ctx.<span class="built_in">resetLog</span>();</span><br><span class="line">    <span class="keyword">if</span> (!sample-&gt;<span class="built_in">handleBuild</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        showLog = <span class="literal">true</span>;</span><br><span class="line">        logScroll = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="built_in">dumpLog</span>(<span class="string">&quot;Build log %s:&quot;</span>, meshName.<span class="built_in">c_str</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Clear test.</span></span><br><span class="line">    <span class="keyword">delete</span> test;</span><br><span class="line">    test = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>“Save”按钮将会把生成的网格存储到</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">文件</th>
<th style="text-align:left">大小</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Solo</td>
<td style="text-align:left">solo_navmesh.bin</td>
<td style="text-align:left">240kb</td>
</tr>
<tr>
<td style="text-align:left">Tile</td>
<td style="text-align:left">all_tiles_navmesh.bin</td>
<td style="text-align:left">479kb</td>
</tr>
<tr>
<td style="text-align:left">TempObstacle</td>
<td style="text-align:left">all_tiles_tilecache.bin</td>
<td style="text-align:left">479kb</td>
</tr>
</tbody>
</table>
</div>
<p>导出时候需要设置的参数：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">变量</th>
<th style="text-align:left">基本信息</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">cellsize</td>
<td style="text-align:left">方块尺寸</td>
<td style="text-align:left">0.3</td>
</tr>
<tr>
<td style="text-align:left">cellheight</td>
<td style="text-align:left">方块高度</td>
<td style="text-align:left">0.2</td>
</tr>
<tr>
<td style="text-align:left">agentheight</td>
<td style="text-align:left">walkableHeight = agentheight/ cellheight</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">agentradius</td>
<td style="text-align:left">walkableClimb = agentradius/ cellheight</td>
<td style="text-align:left">0.6</td>
</tr>
<tr>
<td style="text-align:left">agentmaxclimb</td>
<td style="text-align:left">walkableRadius = agentmaxclimb/ cellheight</td>
<td style="text-align:left">0.9</td>
</tr>
<tr>
<td style="text-align:left">agentmaxslope</td>
<td style="text-align:left">walkableSlopeAngle = agentmaxslope</td>
<td style="text-align:left">45</td>
</tr>
<tr>
<td style="text-align:left">regionminsize</td>
<td style="text-align:left">minRegionArea = regionminsize*regionminsize</td>
<td style="text-align:left">8</td>
</tr>
<tr>
<td style="text-align:left">regionmergesize</td>
<td style="text-align:left">mergeRegionArea = regionmergesize*regionmergesize</td>
<td style="text-align:left">20</td>
</tr>
<tr>
<td style="text-align:left">edgemaxlen</td>
<td style="text-align:left">maxEdgeLen = edgemaxlen/cellheight</td>
<td style="text-align:left">12</td>
</tr>
<tr>
<td style="text-align:left">edgemaxerror</td>
<td style="text-align:left">maxSimplificationError = edgemaxerror</td>
<td style="text-align:left">1.3</td>
</tr>
<tr>
<td style="text-align:left">vertsperpoly</td>
<td style="text-align:left">maxVertsPerPoly</td>
<td style="text-align:left">6</td>
</tr>
<tr>
<td style="text-align:left">detailsampledist</td>
<td style="text-align:left">detailSampleDist = detailsampledist &lt; 0.9f ? 0 : cellsize * detailsampledist;</td>
<td style="text-align:left">6</td>
</tr>
<tr>
<td style="text-align:left">detailsamplemaxerror</td>
<td style="text-align:left">detailSampleMaxError = cellheight * detailsamplemaxerror</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">partitiontype</td>
<td style="text-align:left"></td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">tilesize</td>
<td style="text-align:left"></td>
<td style="text-align:left">48</td>
</tr>
</tbody>
</table>
</div>
<p><a target="_blank" rel="noopener" href="http://www.stevefsp.org/projects/rcndoc/prod/structrcConfig.html">RecastNavigation-rcConfig文档</a></p>
<p>cellsize</p>
<p>方块尺寸（x,z平面上），和平面有关系。较低的值将产生较高质量的导航，但是图形扫描较慢。在文档里面记作 [vx]</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/ymUU0I"><img src="https://s3.ax1x.com/2021/02/02/ymUU0I.gif" alt="ymUU0I.gif"></a></p>
<p>cellheight</p>
<p>方块高度（y高程），和爬坡有关系。记录计算攀爬仰角，攀爬的高度，计算边缘都需要这个。官方文档里面记作 [vy]</p>
<p>agentheight</p>
<hr>
<p>minRegionArea</p>
<p>最小孤岛所容纳的cell数目；</p>
<p>任意区域小于指定的数目，将会标记成无法行走。这个东西通常用于去删除无用几何体，比如桌子的顶部，盒子的顶部等等。</p>
<p>值域：[Limit: &gt;=0] 作用域：[Units: vx]，vx代表平面；</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/ymUNnA"><img src="https://s3.ax1x.com/2021/02/02/ymUNnA.gif" alt="ymUNnA.gif"></a></p>
<p>mergeRegionArea</p>
<p>如果有可能性的话，任意区域如果cell的数目小于它，将会被融合到比它大的区域里面。</p>
<p>值域：[Limit: &gt;=0] 作用域：[Units: vx]</p>
<p>edgemaxlen</p>
<p>沿网格边界的轮廓边缘的最大允许长度。 [Limit: &gt;=0] [Units: vx].</p>
<p>这个将会让边缘更加趋于直线。如果想关闭这个功能将值设置成0。</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/ymUz9O"><img src="https://s3.ax1x.com/2021/02/02/ymUz9O.gif" alt="ymUz9O.gif"></a></p>
<p>partitiontype</p>
<p>分区方式</p>
<p>Watershed 分水岭方式</p>
<p>enum SamplePartitionType SAMPLE_PARTITION_WATERSHED = 0</p>
<blockquote>
<p>大意就是从地势的最低点开始灌水，水漫过的区间若与原区域相邻则认为是同一区域，否则认为是一个新的区域。分水岭算法通常用于图形处理领域，基于图像的灰度值来分割图像。</p>
</blockquote>
<p>Monotone 单调方式</p>
<p>enum SamplePartitionType SAMPLE_PARTITION_MONOTONE = 1</p>
<p>Layers 分层方式</p>
<p>enum SamplePartitionType SAMPLE_PARTITION_LAYERS = 2</p>
<p>原文释义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Partition the heightfield so that we can use simple algorithm later to triangulate the walkable areas.</span><br><span class="line">There are 3 martitioning methods, each with some pros and cons:</span><br><span class="line">1) Watershed partitioning</span><br><span class="line">  - the classic Recast partitioning</span><br><span class="line">  - creates the nicest tessellation</span><br><span class="line">  - usually slowest</span><br><span class="line">  - partitions the heightfield into nice regions without holes or overlaps</span><br><span class="line">  - the are some corner cases where this method creates produces holes and overlaps</span><br><span class="line">     - holes may appear when a small obstacles is close to large open area (triangulation can handle this)</span><br><span class="line">     - overlaps may occur if you have narrow spiral corridors (i.e stairs), this make triangulation to fail</span><br><span class="line">  * generally the best choice if you precompute the nacmesh, use this if you have large open areas</span><br><span class="line">2) Monotone partioning</span><br><span class="line">  - fastest</span><br><span class="line">  - partitions the heightfield into regions without holes and overlaps (guaranteed)</span><br><span class="line">  - creates long thin polygons, which sometimes causes paths with detours</span><br><span class="line">  * use this if you want fast navmesh generation</span><br><span class="line">3) Layer partitoining</span><br><span class="line">  - quite fast</span><br><span class="line">  - partitions the heighfield into non-overlapping regions</span><br><span class="line">  - relies on the triangulation code to cope with holes (thus slower than monotone partitioning)</span><br><span class="line">  - produces better triangles than monotone partitioning</span><br><span class="line">  - does not have the corner cases of watershed partitioning</span><br><span class="line">  - can be slow and create a bit ugly tessellation (still better than monotone)</span><br><span class="line">    if you have large open areas with small obstacles (not a problem if you use tiles)</span><br><span class="line">  * good choice to use for tiled navmesh with medium and small sized tiles</span><br></pre></td></tr></table></figure>
<p>tilesize</p>
<p>每块tile再xz平面上的size。[Limit: &gt;= 0] [Units: vx].</p>
<p>这个值旨在编译出多tile mesh的时候生效（temp obstacles/tiles）。</p>
<h3 id="4-包围盒分类"><a href="#4-包围盒分类" class="headerlink" title="4.包围盒分类"></a>4.包围盒分类</h3><h4 id="4-1-AABB"><a href="#4-1-AABB" class="headerlink" title="4.1.AABB"></a>4.1.AABB</h4><p>AABB算法的全称是 - axis aligned bounding box (轴对齐-边界盒)AABB 包围盒是与坐标轴对齐的包围盒, 简单性好, 紧密性较差。</p>
<p>我们在具体使用的时候，发现如果地形上有一些起伏，最好能通过AABB方式来，这样确保地图中的位置被严格的堵住。</p>
<h4 id="4-2-OBB"><a href="#4-2-OBB" class="headerlink" title="4.2.OBB"></a>4.2.OBB</h4><p>OBB 包围盒: OBB（oriented bounding box 方向矩形边界框） 碰撞检測方法紧密性是较好的, 可以大大降低參与相交測试的包围盒的数目, 因此整体性能要优于AABB 和包围球, 而且实时性程度较高。</p>
<p>OBB在堵路的时候，如果有楼梯类似的地势，将无法做到将导航切割。</p>
<h3 id="阅读-Export-Recast-Navigation-Data-from-UE4"><a href="#阅读-Export-Recast-Navigation-Data-from-UE4" class="headerlink" title="阅读 Export Recast Navigation Data from UE4"></a>阅读 Export Recast Navigation Data from UE4</h3><p>Library: <code>ue-recast-detour</code>这个是从 UE 代码中抽取出的 <code>recast detour</code> 库，在 UE 源码的路径下为 Runtime/Navmesh/Detour，主要目的是保证 UE 客户端与外部服务器的验证方法一致。只将solo方式的导航。</p>
<p>其实在<code>UnrealEngine4</code>的源代码中是有一份<code>NavigationSystem</code>，<code>Navmesh</code>。<a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/tree/release/Engine/Source/Runtime/Navmesh">github-UE4-Navmesh</a>。可以直接在ue4的引擎代码里面找到动态阻挡相关的逻辑。</p>
<h3 id="阅读RecastDemo"><a href="#阅读RecastDemo" class="headerlink" title="阅读RecastDemo"></a>阅读RecastDemo</h3><p>最近在看recast的阻挡相关知识，其实这块最好能扩展一下工具的绘制功能。具体文件目录在<code>recastnavigation\DebugUtils\Include\DebugDraw.h</code></p>
<h4 id="能支持的绘制类型"><a href="#能支持的绘制类型" class="headerlink" title="能支持的绘制类型"></a>能支持的绘制类型</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">duDebugDrawPrimitives</span></span><br><span class="line">&#123;</span><br><span class="line">  DU_DRAW_POINTS, <span class="comment">// 绘制点</span></span><br><span class="line">  DU_DRAW_LINES, <span class="comment">// 绘制线</span></span><br><span class="line">  DU_DRAW_TRIS, <span class="comment">// 三角形</span></span><br><span class="line">  DU_DRAW_QUADS, <span class="comment">// 四边形</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>最终调用的gl函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (prim)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">case</span> DU_DRAW_POINTS:</span><br><span class="line">    <span class="built_in">glPointSize</span>(size);</span><br><span class="line">    <span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> DU_DRAW_LINES:</span><br><span class="line">    <span class="built_in">glLineWidth</span>(size);</span><br><span class="line">    <span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> DU_DRAW_TRIS:</span><br><span class="line">    <span class="built_in">glBegin</span>(GL_TRIANGLES);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> DU_DRAW_QUADS:</span><br><span class="line">    <span class="built_in">glBegin</span>(GL_QUADS);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>最终完成绘图的就是底层的<code>SDL_opengl</code>库的函数。我们这里是使用的<code>SDL 2.0.14</code>版本。</p>
<blockquote>
<p>Simple DirectMedia Layer is a cross-platform development library designed to provide low level access to audio, keyboard, mouse, joystick, and graphics hardware via OpenGL and Direct3D.</p>
</blockquote>
<h4 id="绘制实例"><a href="#绘制实例" class="headerlink" title="绘制实例"></a>绘制实例</h4><h5 id="绘制AABB方块"><a href="#绘制AABB方块" class="headerlink" title="绘制AABB方块"></a>绘制AABB方块</h5><p>通过四边形来拼凑出来。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fShu5j"><img src="https://z3.ax1x.com/2021/08/02/fShu5j.png" alt="fShu5j.png"></a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ob-&gt;type == DT_OBSTACLE_BOX)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> cols[<span class="number">3</span>];<span class="comment">// 其实需要输入6种颜色</span></span><br><span class="line">  cols[<span class="number">0</span>] = <span class="built_in">duRGBA</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">128</span>); <span class="comment">// 需要输入3种颜色作为参数</span></span><br><span class="line">  cols[<span class="number">1</span>] = <span class="built_in">duRGBA</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">128</span>); </span><br><span class="line">  cols[<span class="number">2</span>] = <span class="built_in">duRGBA</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">128</span>);</span><br><span class="line">  <span class="built_in">duDebugDrawBox</span>(dd, bmin[<span class="number">0</span>], bmin[<span class="number">1</span>], bmin[<span class="number">2</span>], bmax[<span class="number">0</span>], bmax[<span class="number">1</span>], bmax[<span class="number">2</span>], cols);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输入参数其实就是AABB的两个顶点位置，fcol是给定颜色</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duDebugDrawBox</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> minx, <span class="type">float</span> miny, <span class="type">float</span> minz,</span></span></span><br><span class="line"><span class="params"><span class="function">          <span class="type">float</span> maxx, <span class="type">float</span> maxy, <span class="type">float</span> maxz, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span>* fcol)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line">  </span><br><span class="line">  dd-&gt;<span class="built_in">begin</span>(DU_DRAW_QUADS);</span><br><span class="line">  <span class="built_in">duAppendBox</span>(dd, minx,miny,minz, maxx,maxy,maxz, fcol);</span><br><span class="line">  dd-&gt;<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制AABB方式的Box</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duAppendBox</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> minx, <span class="type">float</span> miny, <span class="type">float</span> minz,</span></span></span><br><span class="line"><span class="params"><span class="function">         <span class="type">float</span> maxx, <span class="type">float</span> maxy, <span class="type">float</span> maxz, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span>* fcol)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> verts[<span class="number">8</span>*<span class="number">3</span>] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 正面4个顶点，按照逆时针顺序</span></span><br><span class="line">    minx, miny, minz, <span class="comment">// 0</span></span><br><span class="line">    maxx, miny, minz, <span class="comment">// 1</span></span><br><span class="line">    maxx, miny, maxz, <span class="comment">// 2</span></span><br><span class="line">    minx, miny, maxz, <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 背面4个顶点</span></span><br><span class="line">    minx, maxy, minz,</span><br><span class="line">    maxx, maxy, minz,</span><br><span class="line">    maxx, maxy, maxz,</span><br><span class="line">    minx, maxy, maxz,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> inds[<span class="number">6</span>*<span class="number">4</span>] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 每一句话都是从立方体上去一个点，而且刚好是6面体的某个面</span></span><br><span class="line">    <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="comment">// 背面</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="comment">// 正面</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="comment">// 右面</span></span><br><span class="line">    <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="comment">// 左面</span></span><br><span class="line">    <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="comment">// 顶面</span></span><br><span class="line">    <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="comment">// 底部</span></span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 一共能支持读取6种颜色</span></span><br><span class="line">  <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* in = inds;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 每一句话都是从立方体上去一个点，而且刚好是6面体的某个面</span></span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(&amp;verts[*in*<span class="number">3</span>], fcol[i]); in++;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(&amp;verts[*in*<span class="number">3</span>], fcol[i]); in++;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(&amp;verts[*in*<span class="number">3</span>], fcol[i]); in++;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(&amp;verts[*in*<span class="number">3</span>], fcol[i]); in++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="绘制圆柱体"><a href="#绘制圆柱体" class="headerlink" title="绘制圆柱体"></a>绘制圆柱体</h5><p>圆柱体绘制的时候，是按照16等分的圆面，然后用三角形拼凑出来的。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fShnaQ"><img src="https://z3.ax1x.com/2021/08/02/fShnaQ.png" alt="fShnaQ.png"></a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ob-&gt;type == DT_OBSTACLE_CYLINDER)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 绘制圆柱体</span></span><br><span class="line">  <span class="built_in">duDebugDrawCylinder</span>(dd, bmin[<span class="number">0</span>], bmin[<span class="number">1</span>], bmin[<span class="number">2</span>], bmax[<span class="number">0</span>], bmax[<span class="number">1</span>], bmax[<span class="number">2</span>], col);</span><br><span class="line">  <span class="comment">// 绘制圆柱体的线</span></span><br><span class="line">  <span class="built_in">duDebugDrawCylinderWire</span>(dd, bmin[<span class="number">0</span>], bmin[<span class="number">1</span>], bmin[<span class="number">2</span>], bmax[<span class="number">0</span>], bmax[<span class="number">1</span>], bmax[<span class="number">2</span>], <span class="built_in">duDarkenCol</span>(col), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绘制圆柱体，是按照三角形来绘制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duDebugDrawCylinder</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> minx, <span class="type">float</span> miny, <span class="type">float</span> minz,</span></span></span><br><span class="line"><span class="params"><span class="function">             <span class="type">float</span> maxx, <span class="type">float</span> maxy, <span class="type">float</span> maxz, <span class="type">unsigned</span> <span class="type">int</span> col)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line">  </span><br><span class="line">  dd-&gt;<span class="built_in">begin</span>(DU_DRAW_TRIS);</span><br><span class="line">  <span class="built_in">duAppendCylinder</span>(dd, minx,miny,minz, maxx,maxy,maxz, col);</span><br><span class="line">  dd-&gt;<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绘制圆柱体</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duAppendCylinder</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> minx, <span class="type">float</span> miny, <span class="type">float</span> minz,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="type">float</span> maxx, <span class="type">float</span> maxy, <span class="type">float</span> maxz, <span class="type">unsigned</span> <span class="type">int</span> col)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等分16分</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> NUM_SEG = <span class="number">16</span>;</span><br><span class="line">  <span class="type">static</span> <span class="type">float</span> dir[NUM_SEG*<span class="number">2</span>];</span><br><span class="line">  <span class="type">static</span> <span class="type">bool</span> init = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (!init)</span><br><span class="line">  &#123;</span><br><span class="line">    init = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_SEG; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="type">const</span> <span class="type">float</span> a = (<span class="type">float</span>)i/(<span class="type">float</span>)NUM_SEG*DU_PI*<span class="number">2</span>;</span><br><span class="line">      dir[i*<span class="number">2</span>] = <span class="built_in">cosf</span>(a);</span><br><span class="line">      dir[i*<span class="number">2</span>+<span class="number">1</span>] = <span class="built_in">sinf</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> col2 = <span class="built_in">duMultCol</span>(col, <span class="number">160</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> cx = (maxx + minx)/<span class="number">2</span>; <span class="comment">// 计算中心位置</span></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> cz = (maxz + minz)/<span class="number">2</span>;</span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> rx = (maxx - minx)/<span class="number">2</span>; <span class="comment">// 计算x,z的半径</span></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> rz = (maxz - minz)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 绘制底部圆，固定第一个点，然后开始在圆面上按照逆时针找圆周上的邻近两个点，连成三角形，最终构成圆面</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; NUM_SEG; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> a = <span class="number">0</span>, b = i<span class="number">-1</span>, c = i;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[a*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[a*<span class="number">2</span>+<span class="number">1</span>]*rz, col2);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[b*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[b*<span class="number">2</span>+<span class="number">1</span>]*rz, col2);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[c*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[c*<span class="number">2</span>+<span class="number">1</span>]*rz, col2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 绘制顶部圆面</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; NUM_SEG; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> a = <span class="number">0</span>, b = i, c = i<span class="number">-1</span>;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[a*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[a*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[b*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[b*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[c*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[c*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 绘制圆筒，用两个三角形平凑出一个矩形出来</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = NUM_SEG<span class="number">-1</span>; i &lt; NUM_SEG; j = i++)</span><br><span class="line">  &#123;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col2);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[j*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[j*<span class="number">2</span>+<span class="number">1</span>]*rz, col2);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[j*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[j*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line"></span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col2);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[j*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[j*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绘制线条</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duDebugDrawCylinderWire</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> minx, <span class="type">float</span> miny, <span class="type">float</span> minz,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">float</span> maxx, <span class="type">float</span> maxy, <span class="type">float</span> maxz, <span class="type">unsigned</span> <span class="type">int</span> col, <span class="type">const</span> <span class="type">float</span> lineWidth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line">  </span><br><span class="line">  dd-&gt;<span class="built_in">begin</span>(DU_DRAW_LINES, lineWidth);</span><br><span class="line">  <span class="built_in">duAppendCylinderWire</span>(dd, minx,miny,minz, maxx,maxy,maxz, col);</span><br><span class="line">  dd-&gt;<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 画线条</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duAppendCylinderWire</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> minx, <span class="type">float</span> miny, <span class="type">float</span> minz,</span></span></span><br><span class="line"><span class="params"><span class="function">              <span class="type">float</span> maxx, <span class="type">float</span> maxy, <span class="type">float</span> maxz, <span class="type">unsigned</span> <span class="type">int</span> col)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等分16分，计算出对应的标准化后的向量</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> NUM_SEG = <span class="number">16</span>;</span><br><span class="line">  <span class="type">static</span> <span class="type">float</span> dir[NUM_SEG*<span class="number">2</span>];</span><br><span class="line">  <span class="type">static</span> <span class="type">bool</span> init = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (!init)</span><br><span class="line">  &#123;</span><br><span class="line">    init = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_SEG; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="type">const</span> <span class="type">float</span> a = (<span class="type">float</span>)i/(<span class="type">float</span>)NUM_SEG*DU_PI*<span class="number">2</span>;</span><br><span class="line">      dir[i*<span class="number">2</span>] = <span class="built_in">dtMathCosf</span>(a);</span><br><span class="line">      dir[i*<span class="number">2</span>+<span class="number">1</span>] = <span class="built_in">dtMathSinf</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> cx = (maxx + minx)/<span class="number">2</span>; <span class="comment">// 算出中心点位置</span></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> cz = (maxz + minz)/<span class="number">2</span>;</span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> rx = (maxx - minx)/<span class="number">2</span>; <span class="comment">// x,z的半径</span></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> rz = (maxz - minz)/<span class="number">2</span>; </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 循环画圆面</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = NUM_SEG<span class="number">-1</span>; i &lt; NUM_SEG; j = i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 画底部圆，两点连成线</span></span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[j*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[j*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    <span class="comment">// 画顶部圆，两点连成线</span></span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[j*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[j*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 绘制圆柱体4个轴线方向的垂直圆通黑线</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_SEG; i += NUM_SEG/<span class="number">4</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, miny, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(cx+dir[i*<span class="number">2</span>+<span class="number">0</span>]*rx, maxy, cz+dir[i*<span class="number">2</span>+<span class="number">1</span>]*rz, col);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="依葫芦画瓢OBB"><a href="#依葫芦画瓢OBB" class="headerlink" title="依葫芦画瓢OBB"></a>依葫芦画瓢OBB</h5><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/f9YKIg"><img src="https://z3.ax1x.com/2021/08/02/f9YKIg.png" alt="f9YKIg.png"></a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制OBB立方体</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duDebugDrawOBB</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> cx, <span class="type">float</span> cy, <span class="type">float</span> cz,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="type">float</span> extendx, <span class="type">float</span> extendy, <span class="type">float</span> extendz, <span class="type">float</span> yaw, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span>* fcol)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  dd-&gt;<span class="built_in">begin</span>(DU_DRAW_TRIS);</span><br><span class="line">  <span class="built_in">duAppendOBB</span>(dd, cx, cy, cz, extendx, extendy, extendz, yaw, fcol);</span><br><span class="line">  dd-&gt;<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制OBB</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duAppendOBB</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> cx, <span class="type">float</span> cy, <span class="type">float</span> cz,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="type">float</span> extendx, <span class="type">float</span> extendy, <span class="type">float</span> extendz, <span class="type">float</span> yaw, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> *fcol)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">centerPos</span><span class="params">(cx, cy, cz)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 找到AABB点</span></span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p0</span><span class="params">(-extendx,-extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p1</span><span class="params">(extendx, -extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p2</span><span class="params">(extendx, -extendy, extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p3</span><span class="params">(-extendx, -extendy, extendz)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p4</span><span class="params">(-extendx, extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p5</span><span class="params">(extendx, extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p6</span><span class="params">(extendx, extendy, extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p7</span><span class="params">(-extendx, extendy, extendz)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过矩阵将点yaw。</span></span><br><span class="line">  <span class="function">mathfu::Matrix&lt;<span class="type">float</span>, 3&gt; <span class="title">rotation_around_y</span><span class="params">(mathfu::Matrix&lt;<span class="type">float</span>,<span class="number">3</span>&gt;::RotationY(-yaw))</span></span>;</span><br><span class="line">  p0 = p0 * rotation_around_y + centerPos;</span><br><span class="line">  p1 = p1 * rotation_around_y + centerPos;</span><br><span class="line">  p2 = p2 * rotation_around_y + centerPos;</span><br><span class="line">  p3 = p3 * rotation_around_y + centerPos;</span><br><span class="line">  p4 = p4 * rotation_around_y + centerPos;</span><br><span class="line">  p5 = p5 * rotation_around_y + centerPos;</span><br><span class="line">  p6 = p6 * rotation_around_y + centerPos;</span><br><span class="line">  p7 = p7 * rotation_around_y + centerPos;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> verts[<span class="number">8</span> * <span class="number">3</span>] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 正面4个顶点，按照逆时针顺序</span></span><br><span class="line">    p0.x, p0.y, p0.z, <span class="comment">// 0</span></span><br><span class="line">    p1.x, p1.y, p1.z, <span class="comment">// 1</span></span><br><span class="line">    p2.x, p2.y, p2.z, <span class="comment">// 2</span></span><br><span class="line">    p3.x, p3.y, p3.z, <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 背面4个顶点</span></span><br><span class="line">    p4.x, p4.y, p4.z,</span><br><span class="line">    p5.x, p5.y, p5.z,</span><br><span class="line">    p6.x, p6.y, p6.z,</span><br><span class="line">    p7.x, p7.y, p7.z,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> inds[<span class="number">12</span> * <span class="number">3</span>] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 将立方体的每个面都使用两个三角形</span></span><br><span class="line">    <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">    <span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,</span><br><span class="line">    <span class="number">4</span>,<span class="number">7</span>,<span class="number">6</span>,</span><br><span class="line">    <span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,</span><br><span class="line">    <span class="number">6</span>,<span class="number">2</span>,<span class="number">1</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">3</span>,<span class="number">7</span>,</span><br><span class="line">    <span class="number">7</span>,<span class="number">4</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,</span><br><span class="line">    <span class="number">6</span>,<span class="number">7</span>,<span class="number">3</span>,</span><br><span class="line">    <span class="number">5</span>,<span class="number">1</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">4</span>,<span class="number">5</span>,<span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一共能支持读取6种颜色</span></span><br><span class="line">  <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* in = inds;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">auto</span> colidx = i / <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 每一句话都是从立方体上去一个点，而且刚好是6面体的某个面</span></span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(verts[inds[i * <span class="number">3</span>] * <span class="number">3</span>], verts[inds[i * <span class="number">3</span>] * <span class="number">3</span> + <span class="number">1</span>], verts[inds[i * <span class="number">3</span>] * <span class="number">3</span> + <span class="number">2</span>], fcol[colidx]);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(verts[inds[i * <span class="number">3</span> + <span class="number">1</span>] * <span class="number">3</span>], verts[inds[i * <span class="number">3</span> + <span class="number">1</span>] * <span class="number">3</span> + <span class="number">1</span>], verts[inds[i * <span class="number">3</span> + <span class="number">1</span>] * <span class="number">3</span> + <span class="number">2</span>], fcol[colidx]);</span><br><span class="line">    dd-&gt;<span class="built_in">vertex</span>(verts[inds[i * <span class="number">3</span> + <span class="number">2</span>] * <span class="number">3</span>], verts[inds[i * <span class="number">3</span> + <span class="number">2</span>] * <span class="number">3</span> + <span class="number">1</span>], verts[inds[i * <span class="number">3</span> + <span class="number">2</span>] * <span class="number">3</span> + <span class="number">2</span>], fcol[colidx]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 画出OBB棱角</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">duAppendOBBWire</span><span class="params">(<span class="keyword">struct</span> duDebugDraw* dd, <span class="type">float</span> cx, <span class="type">float</span> cy, <span class="type">float</span> cz,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="type">float</span> extendx, <span class="type">float</span> extendy, <span class="type">float</span> extendz, <span class="type">float</span> yaw,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="type">unsigned</span> <span class="type">int</span> col)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dd) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">centerPos</span><span class="params">(cx, cy, cz)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 找到AABB点</span></span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p0</span><span class="params">(-extendx, -extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p1</span><span class="params">(extendx, -extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p2</span><span class="params">(extendx, -extendy, extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p3</span><span class="params">(-extendx, -extendy, extendz)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p4</span><span class="params">(-extendx, extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p5</span><span class="params">(extendx, extendy, -extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p6</span><span class="params">(extendx, extendy, extendz)</span></span>;</span><br><span class="line">  <span class="function">mathfu::Vector&lt;<span class="type">float</span>, 3&gt; <span class="title">p7</span><span class="params">(-extendx, extendy, extendz)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过矩阵将点yaw。</span></span><br><span class="line">  <span class="function">mathfu::Matrix&lt;<span class="type">float</span>, 3&gt; <span class="title">rotation_around_y</span><span class="params">(mathfu::Matrix&lt;<span class="type">float</span>, <span class="number">3</span>&gt;::RotationY(-yaw))</span></span>;</span><br><span class="line">  p0 = p0 * rotation_around_y + centerPos;</span><br><span class="line">  p1 = p1 * rotation_around_y + centerPos;</span><br><span class="line">  p2 = p2 * rotation_around_y + centerPos;</span><br><span class="line">  p3 = p3 * rotation_around_y + centerPos;</span><br><span class="line">  p4 = p4 * rotation_around_y + centerPos;</span><br><span class="line">  p5 = p5 * rotation_around_y + centerPos;</span><br><span class="line">  p6 = p6 * rotation_around_y + centerPos;</span><br><span class="line">  p7 = p7 * rotation_around_y + centerPos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">float</span> verts[<span class="number">8</span> * <span class="number">3</span>] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 正面4个顶点，按照逆时针顺序</span></span><br><span class="line">    p0.x, p0.y, p0.z, <span class="comment">// 0</span></span><br><span class="line">    p1.x, p1.y, p1.z, <span class="comment">// 1</span></span><br><span class="line">    p2.x, p2.y, p2.z, <span class="comment">// 2</span></span><br><span class="line">    p3.x, p3.y, p3.z, <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 背面4个顶点</span></span><br><span class="line">    p4.x, p4.y, p4.z,</span><br><span class="line">    p5.x, p5.y, p5.z,</span><br><span class="line">    p6.x, p6.y, p6.z,</span><br><span class="line">    p7.x, p7.y, p7.z,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Top</span></span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p3.x, p3.y, p3.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p2.x, p2.y, p2.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p2.x, p2.y, p2.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p6.x, p6.y, p6.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p6.x, p6.y, p6.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p7.x, p7.y, p7.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p7.x, p7.y, p7.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p3.x, p3.y, p3.z, col);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// bottom</span></span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p0.x, p0.y, p0.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p1.x, p1.y, p1.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p1.x, p1.y, p1.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p5.x, p5.y, p5.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p5.x, p5.y, p5.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p4.x, p4.y, p4.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p4.x, p4.y, p4.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p0.x, p0.y, p0.z, col);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Sides</span></span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p0.x, p0.y, p0.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p3.x, p3.y, p3.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p1.x, p1.y, p1.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p2.x, p2.y, p2.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p5.x, p5.y, p5.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p6.x, p6.y, p6.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p4.x, p4.y, p4.z, col);</span><br><span class="line">  dd-&gt;<span class="built_in">vertex</span>(p7.x, p7.y, p7.z, col);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="阅读导出时系数"><a href="#阅读导出时系数" class="headerlink" title="阅读导出时系数"></a>阅读导出时系数</h4><h5 id="agent"><a href="#agent" class="headerlink" title="agent"></a>agent</h5><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fPYIyR"><img src="https://z3.ax1x.com/2021/08/03/fPYIyR.png" alt="fPYIyR.png"></a><a target="_blank" rel="noopener" href="https://imgtu.com/i/fPYoO1"><img src="https://z3.ax1x.com/2021/08/03/fPYoO1.png" alt="fPYoO1.png"></a></p>
<p>修改了agent的半径之后，就能让AABB方式的动态墙切断navimesh。</p>
<h5 id="imgui用法"><a href="#imgui用法" class="headerlink" title="imgui用法"></a>imgui用法</h5><p>如何使用单选框</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sample</span> &#123;</span><br><span class="line">  <span class="type">int</span> m_partitionType; <span class="comment">// 先定义一个选项类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义选项类型</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">SamplePartitionType</span></span><br><span class="line">&#123;</span><br><span class="line">  SAMPLE_PARTITION_WATERSHED,</span><br><span class="line">  SAMPLE_PARTITION_MONOTONE,</span><br><span class="line">  SAMPLE_PARTITION_LAYERS,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定ui关系</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sample::handleCommonSettings</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">imguiSeparator</span>();</span><br><span class="line">  <span class="built_in">imguiLabel</span>(<span class="string">&quot;Partitioning&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">imguiCheck</span>(<span class="string">&quot;Watershed&quot;</span>, m_partitionType == SAMPLE_PARTITION_WATERSHED))</span><br><span class="line">    m_partitionType = SAMPLE_PARTITION_WATERSHED;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">imguiCheck</span>(<span class="string">&quot;Monotone&quot;</span>, m_partitionType == SAMPLE_PARTITION_MONOTONE))</span><br><span class="line">    m_partitionType = SAMPLE_PARTITION_MONOTONE;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">imguiCheck</span>(<span class="string">&quot;Layers&quot;</span>, m_partitionType == SAMPLE_PARTITION_LAYERS))</span><br><span class="line">    m_partitionType = SAMPLE_PARTITION_LAYERS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="obb如何被导出"><a href="#obb如何被导出" class="headerlink" title="obb如何被导出"></a>obb如何被导出</h4><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>相同体型的阻挡信息，长宽高为 10m<em>2m</em>6.5m。AABB动态阻挡能隔断mesh，但是OBB动态阻挡（旋转90°）无法阻断mesh。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fAfk8S"><img src="https://z3.ax1x.com/2021/08/04/fAfk8S.png" alt="fAfk8S.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fAfFC8"><img src="https://z3.ax1x.com/2021/08/04/fAfFC8.png" alt="fAfFC8.png"></a></p>
<p>使用OBB的时候，将会在获取触碰到的titles有21个。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fAhFd1"><img src="https://z3.ax1x.com/2021/08/04/fAhFd1.png" alt="fAhFd1.png"></a></p>
<p>使用AABB的时候，将会获取触碰到的titles只有6个。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/fAhiZR"><img src="https://z3.ax1x.com/2021/08/04/fAhiZR.png" alt="fAhiZR.png"></a></p>
<p>源码里面只能让一个阻挡点碰撞到8个tiltes。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> DT_MAX_TOUCHED_TILES = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">dtTileCacheObstacle</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">union</span></span><br><span class="line">  &#123;</span><br><span class="line">    dtObstacleCylinder cylinder;</span><br><span class="line">    dtObstacleBox box;</span><br><span class="line">    dtObstacleOrientedBox orientedBox;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  dtCompressedTileRef touched[DT_MAX_TOUCHED_TILES];</span><br><span class="line">  dtCompressedTileRef pending[DT_MAX_TOUCHED_TILES];</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> salt;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> type;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> state;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> ntouched;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> npending;</span><br><span class="line">  dtTileCacheObstacle* next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>所以OBB少去检查了titles造成了问题。如果我们将缓冲区加大之后就不会有问题。</p>
<p>为啥OBB需要碰撞这么多点？原因还是在于这些代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> dtObstacleOrientedBox &amp;orientedBox = ob-&gt;orientedBox;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> maxr = <span class="number">1.41f</span>*<span class="built_in">dtMax</span>(orientedBox.halfExtents[<span class="number">0</span>], orientedBox.halfExtents[<span class="number">2</span>]);</span><br><span class="line">bmin[<span class="number">0</span>] = orientedBox.center[<span class="number">0</span>] - maxr;</span><br><span class="line">bmax[<span class="number">0</span>] = orientedBox.center[<span class="number">0</span>] + maxr;</span><br><span class="line">bmin[<span class="number">1</span>] = orientedBox.center[<span class="number">1</span>] - orientedBox.halfExtents[<span class="number">1</span>];</span><br><span class="line">bmax[<span class="number">1</span>] = orientedBox.center[<span class="number">1</span>] + orientedBox.halfExtents[<span class="number">1</span>];</span><br><span class="line">bmin[<span class="number">2</span>] = orientedBox.center[<span class="number">2</span>] - maxr;</span><br><span class="line">bmax[<span class="number">2</span>] = orientedBox.center[<span class="number">2</span>] + maxr;</span><br></pre></td></tr></table></figure>
<p>这段代码的意思是，OBB的X,Z的最大值<em>1.41，形成的一个正方形。所以会比相同的AABB的形状大很多。10m</em>1.141见方的一个方块（130.1881平方米），而AABB是 10m*2m（20平方米），大了6.5倍。我这里先使用矩阵把矩形框旋转，投影到X,Z轴上。让bounding更小，只要不突破8个上限，就能正常工作。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li>[1] <a target="_blank" rel="noopener" href="https://github.com/recastnavigation/recastnavigation">recastnavigation</a></li>
<li>[2] <a target="_blank" rel="noopener" href="https://premake.github.io/download.html#v5">premake</a></li>
<li>[3] <a target="_blank" rel="noopener" href="https://www.libsdl.org/download-2.0.php">SDL</a></li>
<li>[4] <a target="_blank" rel="noopener" href="http://masagroup.github.io/recastdetour/index.html">recastdetour手册</a></li>
<li>[5] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35100455">游戏的寻路导航 1：导航网格</a></li>
<li>[6] <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34132768/article/details/93762363">recastNavigation读书笔记1</a></li>
<li>[7] <a target="_blank" rel="noopener" href="http://critterai.org/projects/nmgen_study/overview.html">CritterAI</a></li>
<li>[8] <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1uK4y1E7CV?from=search&amp;seid=8637375892047322871">B站讲解RecastDemo如何使用</a></li>
<li>[9] <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/64469a410b5d">从零开始学习导航网格</a></li>
<li>[10] <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mfrbuaa/p/4073880.html">AABB&amp;OBB包围盒</a></li>
<li>[11] <a target="_blank" rel="noopener" href="https://blog.csdn.net/Kathy_unity/article/details/81583968">生成寻路网格的配置</a></li>
<li>[12] <a target="_blank" rel="noopener" href="https://arongranberg.com/astar/docs/createnavmesh.html">手动创建navmesh</a></li>
<li>[13] <a target="_blank" rel="noopener" href="https://arongranberg.com/astar/docs/recastgraph.html">navmesh参数</a></li>
<li>[14] <a target="_blank" rel="noopener" href="https://imzlp.com/posts/20203/">ue-navmesh</a></li>
<li>[15] <a target="_blank" rel="noopener" href="https://imzlp.com/posts/20203/">循迹研究室-Export Recast Navigation</a></li>
<li>[16] <a target="_blank" rel="noopener" href="https://github.com/libigl/libigl/">libIGL</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Game/" rel="tag"># Game</a>
              <a href="/tags/recast/" rel="tag"># recast</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/21/cannon-guitarsheet/" rel="prev" title="卡农吉他谱">
      <i class="fa fa-chevron-left"></i> 卡农吉他谱
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/25/go-debug/" rel="next" title="go-debug">
      go-debug <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Recast-%E5%85%A5%E9%97%A8"><span class="nav-number">1.</span> <span class="nav-text">Recast-入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Recast%E5%B7%A5%E7%A8%8B%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">1. Recast工程介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.2.</span> <span class="nav-text">2.环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E7%BC%96%E8%AF%91recastnavigation"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1.编译recastnavigation</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-1-%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">2.1.1.下载地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-2-%E5%87%86%E5%A4%87%E5%A5%BDSDL2%E7%9A%84dll"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">2.1.2.准备好SDL2的dll</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-3-%E4%BD%BF%E7%94%A8premake5%E7%94%9F%E6%88%90%E5%B7%A5%E7%A8%8B%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">2.1.3.使用premake5生成工程文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Recast-%E5%AF%BC%E8%88%AA%E7%BD%91%E6%A0%BC%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.</span> <span class="nav-text">3.Recast 导航网格类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-SoloMesh"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1.SoloMesh</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-TileMesh"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2.TileMesh</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-TempObstacles"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3.TempObstacles</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-%E5%AF%BC%E5%87%BAMesh%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4.导出Mesh的源码分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8C%85%E5%9B%B4%E7%9B%92%E5%88%86%E7%B1%BB"><span class="nav-number">1.4.</span> <span class="nav-text">4.包围盒分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-AABB"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1.AABB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-OBB"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2.OBB</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%85%E8%AF%BB-Export-Recast-Navigation-Data-from-UE4"><span class="nav-number">1.5.</span> <span class="nav-text">阅读 Export Recast Navigation Data from UE4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%85%E8%AF%BBRecastDemo"><span class="nav-number">1.6.</span> <span class="nav-text">阅读RecastDemo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%BD%E6%94%AF%E6%8C%81%E7%9A%84%E7%BB%98%E5%88%B6%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.6.1.</span> <span class="nav-text">能支持的绘制类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.6.2.</span> <span class="nav-text">绘制实例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%98%E5%88%B6AABB%E6%96%B9%E5%9D%97"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">绘制AABB方块</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%9C%86%E6%9F%B1%E4%BD%93"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">绘制圆柱体</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BE%9D%E8%91%AB%E8%8A%A6%E7%94%BB%E7%93%A2OBB"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">依葫芦画瓢OBB</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%85%E8%AF%BB%E5%AF%BC%E5%87%BA%E6%97%B6%E7%B3%BB%E6%95%B0"><span class="nav-number">1.6.3.</span> <span class="nav-text">阅读导出时系数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#agent"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">agent</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#imgui%E7%94%A8%E6%B3%95"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">imgui用法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#obb%E5%A6%82%E4%BD%95%E8%A2%AB%E5%AF%BC%E5%87%BA"><span class="nav-number">1.6.4.</span> <span class="nav-text">obb如何被导出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.6.5.</span> <span class="nav-text">问题描述</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">1.7.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Abel Sean"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Abel Sean</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">87</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://blog.csdn.net/erlang_hell" title="http:&#x2F;&#x2F;blog.csdn.net&#x2F;erlang_hell" rel="noopener" target="_blank">我的csdn-blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://dengwenyi88.github.io/" title="https:&#x2F;&#x2F;dengwenyi88.github.io&#x2F;" rel="noopener" target="_blank">dwy-blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://unity3d.io/" title="https:&#x2F;&#x2F;unity3d.io" rel="noopener" target="_blank">蔡总-blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Abel Sean</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'b08c5201a4a52badc863',
      clientSecret: 'dd2c48988eb499969198746dae8ec2c7ccbad00b',
      repo        : 'BlogComment',
      owner       : 'swordhell',
      admin       : ['swordhell'],
      id          : 'cded618740a21b69520d4d307ccd0917',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
